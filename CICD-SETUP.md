# Настройка CI/CD для YumRush

Этот документ содержит инструкции по настройке непрерывной интеграции и непрерывного развертывания (CI/CD) для проекта YumRush.

## GitHub Actions

GitHub Actions используются для автоматизации тестирования и деплоя. Пайплайн настроен в файле `.github/workflows/main.yml` и выполняет следующие шаги:

1. При каждом пуше или PR в ветку `main`:
   - Запускает тесты, линтинг и проверку типов для бэкенда
   - Запускает тесты, линтинг и проверку типов для фронтенда

2. При успешном прохождении тестов и пуше в ветку `main`:
   - Триггерит деплой бэкенда на Render
   - Деплоит фронтенд на Vercel

## Настройка GitHub Actions

### 1. Настройка секретов в GitHub

В репозитории необходимо настроить следующие секреты:

1. Перейдите в настройки вашего репозитория: `Settings > Secrets and variables > Actions`
2. Добавьте следующие секреты:

   - `RENDER_DEPLOY_HOOK`: URL вебхука для деплоя на Render
   - `VERCEL_TOKEN`: API токен Vercel
   - `VERCEL_ORG_ID`: ID вашей организации в Vercel 
   - `VERCEL_PROJECT_ID`: ID вашего проекта в Vercel

### 2. Получение деплой хука Render

1. Войдите в свою учетную запись Render
2. Выберите ваш сервис бэкенда
3. Перейдите в `Settings > Deploy Hooks`
4. Создайте новый хук: `Create Deploy Hook`
5. Назовите его "GitHub Actions" и выберите ветку `main`
6. Скопируйте сгенерированный URL и сохраните его как секрет `RENDER_DEPLOY_HOOK` в GitHub

### 3. Получение токенов Vercel

1. Войдите в свою учетную запись Vercel
2. Перейдите в `Settings > Tokens`
3. Создайте новый токен: `Create Token` 
4. Назовите его "GitHub Actions" и установите `Full Account` доступ
5. Скопируйте токен и сохраните его как секрет `VERCEL_TOKEN` в GitHub

### 4. Получение ID проекта и организации Vercel

1. Установите Vercel CLI: `npm i -g vercel`
2. Войдите в свою учетную запись: `vercel login`
3. Перейдите в корневую директорию проекта и выполните: `vercel link`
4. После связывания, посмотрите файл `.vercel/project.json`
5. В этом файле вы найдете `orgId` и `projectId`
6. Сохраните их как секреты `VERCEL_ORG_ID` и `VERCEL_PROJECT_ID` в GitHub

## Проверка настройки CI/CD

После настройки всех секретов и пуша в ветку `main`, вы должны увидеть запуск GitHub Actions workflow:

1. Перейдите в раздел `Actions` вашего репозитория
2. Вы должны увидеть запущенный workflow "YumRush CI/CD Pipeline"
3. После успешного завершения, ваше приложение будет автоматически развернуто:
   - Фронтенд на Vercel
   - Бэкенд на Render

## Мониторинг деплоев

- **Vercel**: Доступ к логам и статусу деплоя через дашборд Vercel
- **Render**: Доступ к логам и статусу деплоя через дашборд Render

## Устранение неполадок

Если возникли проблемы с CI/CD:

1. Проверьте логи в разделе GitHub Actions
2. Убедитесь, что все секреты настроены правильно
3. Проверьте, что токены не истекли
4. Убедитесь, что вебхук Render имеет правильный URL и активен
5. Проверьте настройки проекта в Vercel (рабочая директория, скрипты сборки и т.д.)

## Дополнительные ресурсы

- [Документация GitHub Actions](https://docs.github.com/en/actions)
- [Документация Vercel для CI/CD](https://vercel.com/docs/concepts/git/vercel-for-github)
- [Документация Render по деплою](https://render.com/docs/deploy-hooks)